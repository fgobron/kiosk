<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">

<link rel="import" href="../generic/app-localize-behavior.html">
<link rel="import" href="../generic/app-tag-manager-behaviour.html">

<link rel="import" href="./../common/planet-kiosk-icons.html">

<link rel="import" href="./../planet-kiosk-abandon.html">

<dom-module id="planet-kiosk-pmr-tabbar">
  <template>
    <style include="iron-flex iron-flex-alignment">      
      app-toolbar {
        position: fixed;
        background-color: var(--planet-color-theme-primary);       
        width:100%;
        height: 2.75em;
        bottom: 0;
        padding: 0;      
      }
      
      paper-button {
        font-family: var(--planet-font-family-book);
        font-size: 1.1em;
        text-transform: none;
        color: var(--planet-color-theme-opposite);
        background-color: var(--planet-color-theme-primary);        
        height: 2.5em;
        padding: 0;
        margin: 0;
        border-left: solid 1px var(--planet-color-theme-opposite);
        text-align: center;        
      }
      
      paper-button.s {
        width: 8.181818182em;
      }
      
      paper-button.m {
        width: 9.818181818em;
      }
      
      paper-button.l {
        width: 12.272727273em;
      }
      
      paper-button.xl {
        width: 16.363636364em;
      }
      
      paper-button span.highlighted {
        display: block;
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 1px;
        background-color: var(--planet-color-theme-opposite);
      }
      
      paper-button.warning {
        background-color: var(--planet-color-theme-warning);        
      }
      
      paper-button.last,
      paper-button.first {
        border: none;
      }
      
      iron-icon {
        width:2em;
        height:2em;
        padding: 0.4em;
      }
      
      a {
        text-decoration: none;
      }
    </style>
    
    <template is="dom-if" if="{{_isEqualTo(collection, 'pmr')}}">
      <app-toolbar class="horizontal layout center-justified">
        <a on-tap="_backPMR">
          <paper-button class="first m">
            <iron-icon icon="tabbar:pmr"></iron-icon>
            {{localize('tabbar_normal')}}
          </paper-button>
        </a>
      </app-toolbar>
    </template>
    
    <template is="dom-if" if="{{_isEqualTo(collection, 'full')}}">
      <app-toolbar>
        <a href="#">
          <paper-button class$="first [[size]]">
            <iron-icon icon="tabbar:home"></iron-icon>
            {{localize('tabbar_home')}}
            <span hidden$="[[!_isHighlighted('home')]]" class="highlighted"></span>
          </paper-button>
        </a>
        <a href="#" hidden="[[_paymentNotActive()]]">
          <paper-button class$="[[size]]">
            <iron-icon icon="tabbar:basket"></iron-icon>
            {{localize('tabbar_basket')}}
            <span hidden$="[[!_isHighlighted('basket')]]" class="highlighted"></span>
          </paper-button>
        </a>
        <a href="#/map" on-tap="_trackNavigation">
          <paper-button class$="[[size]]">
            <iron-icon icon="tabbar:map"></iron-icon>
            {{localize('tabbar_map')}}
            <span hidden$="[[!_isHighlighted('map')]]" class="highlighted"></span>
          </paper-button>
        </a>
        <a on-tap="_back" hidden="[[_prmNotActive()]]">
          <paper-button class$="[[size]]">
            <iron-icon icon="tabbar:pmr"></iron-icon>
            {{localize('tabbar_normal')}}
          </paper-button>
        </a>
        <paper-button class$="warning last [[size]]" on-tap="_reset">
          <iron-icon icon="tabbar:abandon"></iron-icon>
          {{localize('tabbar_abandon')}}
        </paper-button>
      </app-toolbar>
    </template>
    
    <planet-kiosk-abandon id="abandon" language="[[language]]" with-backdrop="" no-cancel-on-outside-click=""></planet-kiosk-abandon>    
  </template>

  <script>  
  Polymer({
    is: 'planet-kiosk-pmr-tabbar',
    behaviors: [
      AppLocalizeBehavior,
      TagManagerBehavior
    ],
    properties: {
      highlightedPage: {
        type: String,
        value: ''
      },
      size: {
        type: String,
        default: ''
      },
      collection: String
    },
    listeners: {
      'tap': '_onGlobalTap',        
    },
    attached: function () {      
      this._setSize();      
    },
    _paymentNotActive: function () {
      return !globals.payment;
    },
    _prmNotActive: function () {
      return !globals.pmr;
    },
    _setSize: function () {
      if (globals.payment && globals.pmr) {
        this.set('size','m');
      } else {
        if (globals.payment || globals.pmr) {
          this.set('size','l');  
        } else {
          this.set('size', 'xl');
        }        
      }      
    },
    _isHighlighted: function (itemName) {
      return this.highlightedPage === itemName;
    },
    _isEqualTo : function (collection, value) {
      return collection === value;
    },
    _onGlobalTap: function () {
      // restore empty queryParams for futur navigation
      // remove edit mode after detail activity modification in basket
      globals.router.set('queryParams', {});
    },
    _backPMR: function () {            
      window.history.back();
      this.trackEvent('Language selection', 'pmr button', 'click', 'noevent');
      this.setDataLayerItem('type_session', 'normal');
      
    },
    _back: function () {      
      window.history.back();
      this.trackEvent('Navigation bar', 'pmr', 'click', 'noevent');
      this.setDataLayerItem('type_session', 'normal');
    },
    _trackNavigation: function (e) {
      var target = e.currentTarget;
      var tab = target.getAttribute('href').replace('#/', '');
      this.trackEvent('Navigation bar', tab, 'click', 'noevent');      
    },
    _reset: function () {
      this.$.abandon.open();
      this.trackEvent('Navigation bar', 'abandon', 'click', 'noevent');
    }
  });

  </script>
</dom-module>