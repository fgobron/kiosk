<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-input/iron-input.html">

<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="./generic/app-localize-behavior.html">

<dom-module id="planet-kiosk-quantity">
  <template strip-whitespace="">
    <style>
    :host {      
      --paper-fab-background: none;
      --paper-fab-keyboard-focus-background: transparent;
      --paper-fab: {
        padding:0;
        width: 9em;
        height: 9em;
      }
      --paper-fab-label: {
        font-size: 4em;
        font-family: var(--planet-font-family-book);
        color: var(--planet-color-theme-btn);        
      }
    }
    
    .control {
      @apply(--layout-horizontal);
      @apply(--layout-center-center);
    }
    
    .error {
      font-size: 2em;
      font-family: var(--planet-font-family-book);
      color: var(--planet-color-theme-error);
      font-weight: normal; 
    }
    
    paper-fab {
      box-shadow: none;
      border: 1px solid var(--planet-color-theme-border-btn);
    }
    
    paper-fab[disabled] {
      background: none;
      opacity: 0.2;
    }
    
    paper-fab[pressed] {
      box-shadow: none;
      
    }
    
    input {
      font-family: var(--planet-font-family-book);
      color: var(--planet-color-theme-primary);
      border:none;
      font-size: 6em;
      width: 1.5em;
      height: 1.5em;      
      vertical-align: middle;
      text-align: center;
      padding-top: 0.1666666666em;
    }    
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
      -webkit-appearance: none; 
      margin: 0; 
    }
    input[type=number]:disabled {
      background-color: transparent;
    }
    
    </style>
    <div class="control">
      <paper-fab id="minus" label="-"></paper-fab>
      <input id="quantity" is="iron-input" bind-value="{{value}}" value="{{value::input}}" type="number" disabled="">
      <paper-fab id="plus" label="+"></paper-fab>  
    </div>
    
    <p id="error" class="error" hidden$="{{errorHidden}}">[[errorMessage]]</p>
  </template>

  <script>
    Polymer({
      is: 'planet-kiosk-quantity',
      behaviors: [
        AppLocalizeBehavior        
      ],
      properties: {
        value: {
          type: Number,          
          reflectToAttribute: true,
          notify: true
        },
        min: {
          type: Number,
          value: 1
        },
        max: {
          type: Number          
        },
        errorMessage: {
          type: String,
          value: ''
        },
        errorHidden: {
          type: Boolean,
          value: true
        }
      },
      attached: function () {        
        this.listen(this.$.minus, 'tap', '_onMinus');
        this.listen(this.$.plus, 'tap', '_onPlus');
      },
      _onMinus: function () {        
        if (this.value > this.get('min')) {
          this.$.quantity.bindValue -= 1;
        }
        this._validate();
      },
      _onPlus: function () {                
        if (this.value < this.get('max')) {
          this.$.quantity.bindValue += 1;
        }
        this._validate();
      },
      _validate: function () {
        var min = this.get('min');
        var max = this.get('max');
        if (this.value <= min) {
          this.$.minus.setAttribute('disabled', true);          
        } else if (min<this.value && this.value<max) {
          this.$.minus.removeAttribute('disabled');
          this.$.plus.removeAttribute('disabled');
          this.set('errorMessage', '');
          this.set('errorHidden', true);
        } else if (this.value >= max) {
          this.$.plus.setAttribute('disabled', true);
          this.set('errorMessage', this.localize('activity_quantity_max'));
          this.set('errorHidden', false);
        }
        this.fire('quantity-change', {quantity: this.value});
      },
      checkActivation: function (quantity) {
        var max = this.get('max');
        // Default values setting
        this.set('value', quantity);
        this.set('errorHidden', true);        
        this.$.minus.removeAttribute('disabled');
        this.$.plus.removeAttribute('disabled');
        
        if (quantity === 1) {
          this.$.minus.setAttribute('disabled', true);
        }
        
        if (quantity === max) {
          this.$.plus.setAttribute('disabled', true);
          this.set('errorMessage', this.localize('activity_quantity_max'));
          this.set('errorHidden', false);
        }
        
        if (max <= 1) {
          this.$.minus.setAttribute('disabled', true);
          this.$.plus.setAttribute('disabled', true);
          
          if (max === 1) {          
            this.set('errorMessage', this.localize('activity_quantity_max'));
            this.set('errorHidden', false);
          }
          
          if (max === 0) {          
            this.set('value', 0);          
            this.set('errorMessage', this.localize('activity_quantity_full'));
            this.set('errorHidden', false);
          }
        }
        
      }    
    });
  </script>
</dom-module>